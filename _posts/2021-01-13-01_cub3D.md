---
layout: post
title: cub3D 이론
subtitle: [TIL15 42seoul]
thumbnail-img: ../images/task.png
tags: [TIL, 42seoul, CG]
comments: true
---

## 개요

[http://users.atw.hu/wolf3d/](http://users.atw.hu/wolf3d/)

위의 링크로 들어가면 '울펜슈타인 3D'라는 게임이 나온다.

울펜슈타인은 '존 카맥'과 '존 로메로'가 만든 1인칭 FPS의 전설적인 게임이다.

앞으로 진행하게 될 cub3D는 울펜슈타인 3D를 구현한 기술인 레이캐스팅을 이용해 1인칭 FPS 게임을 구현하는 첫 컴퓨터그래픽스 과제이다. (능력이 된다면 추가적인 여러 기능들과, 몬스터를 구현할 수 있다.)

<img src = "../images/posts/210113/Untitled 01.png" width="50%">  
<br><br>

## 레이캐스팅(Ray Casting)이 뭘까?

- 광선(Ray)을 던져(Casting) 렌더링하는 기술이다. (렌더링: 컴퓨터를 이용해 2D 혹은 3D 장면을 바탕으로 그래픽을 만드는 기법)  

- 2D 맵을 3D처럼 표현할 수 있다.  

- 관찰자에서부터 광선이 던져지면 물체에 도달한다. 그 후 물체의 종류를 판단하여 렌더링한다.  

- 1982년 '스코트 로스'의 컴퓨터 그래픽스 논문에서 처음 나온 용어  

- 컴퓨터 성능이 좋지 않아 3D 엔진을 실시간으로 사용할 수 없던 시기의 최초 해결책  

- 울펜슈타인 3D는 레이캐스팅을 이용해 만든 가장 유명한 게임  
<br><br>

### 레이캐스팅 VS 레이트레이싱(Ray Tracing)

- 광선을 던져 그래픽을 생성하는 원리는 같지만, 광선을 어디까지 감지하여 계산하는 방법이 다르다.  

- 레이캐스팅은 광선이 처음 만나는 물체를 계산한다. 반면에 레이트레이싱은 광선이 물체에 도달하면 생성되는 거기서 빛의 반사, 투영까지 추적하여 계산한다.  

- 그래서 레이캐스팅의 렌더링 속도가 월등히 빠를 수 밖에 없지만, 레이트레이싱의 그래픽은 더욱 현실적이다.  

- 훗날 컴퓨터의 성능이 발달하면, 레이캐스팅은 저물고 레이트레이싱의 시대가 올 것같다.  
<br>

## 기본적인 원리

- 2D 정사각형 그리드의 맵이다.  

- 맵의 각 사각형은 0 혹은 양수의 값을 갖는다.  
    - 0 = 벽이 없다.  

    - 양수 = 벽이 있다, 특정 색상 또는 특정 질감을 나타낸다.  
<br><br>

### 레이캐스팅 진행 과정

1. 플레이어에서 시작하는 광선을 쏜다.  

2. 이 때 광선의 방향은 플레이어가 보는 방향, 그리고 화면의 x좌표에 의존한다.  

3. 광선이 벽에 부딪치면 적중 지점과 플레이어 사이의 거리를 측정한다.  

4. 이 거리에 따라 렌더링할 물체의 높이가 결정된다. 물체의 높이는 플레이어와 물체 사이의 거리가 멀수록 화면에 더 낮게, 가까울 수록 더 높게 표시된다. (원근법)  

5. 이것들은 모두 2차원 계산으로 구할 수 있는 들입니다.  
<br>

### 광선과 물체가 접촉하는 위치 찾기

광선과 물체가 접촉해야 플레이어와 물체 사이의 거리를 계산할 수 있다. 광선이 물체와 접촉하는 위치는 판단루프를 통해 도출해낼 것이다.  


- 광선이 물체와 접촉하는 것으로 확인되면, 물체와의 접촉을 확인하던 판단 루프는 멈추게 되고, 거리를 측정해서 원근감을 표현한다.  
<br>

### 광선이 물체와 접촉해도 위치를 반환하지 않는 경우

**원인**

- 광선이 물체와 닿았을 때 접촉을 판단하는 루프가 광선보다 느리게 작동하여 판단하지 못했을 경우  
<br>

**해결법**

1. 접촉을 판단하는 간격 줄이는 방법 - 정확하지도 않고, 더욱 많은 계산량이 요구되어 효율성이 떨어진다.  

2. **광선이 만나는 그리드의 모든 면을 확인하는 방법(DDA)** - 계산량이 훨씬 줄어들고, 정확한 위치를 반환할 수 있다.  
<br>

### DDA(Digital Differential Analyzer) 알고리즘

- 2차원 그리드를 지나가는 선이 어떤 칸과 부딪치는 지 찾을 때 사용되는 알고리즘 중 하나  

- 빠른 속도  

- 벽에 부딪친 것이 확인되면 알고리즘은 중단된다.  
