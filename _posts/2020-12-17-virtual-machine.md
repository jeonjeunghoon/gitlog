---
layout: post
title: 하이퍼바이저와 컨테이너
subtitle: [TIL06 Tech]
thumbnail-img: ../images/task.png
tags: [TIL, Tech, 가상화머신, 컨테이너]
comments: true
---
## 하이퍼바이저 (VMM)

- 가상 머신을 생성하고 작동시키기 위한 소프트웨어이다.

- 게스트 운영 체제에 가상 운영 플랫폼을 제공하고 게스트 운영 체제의 실행을 관리한다.

- 다양한 운영 체제의 여러 가상 머신은 가상화된 하드웨어 리소스를 공유할 수 있다.

- 감독관인 supervisor의 이름에서 따온 용어이다. 가상머신을 감독해서 그런 것같다.  
<br>

## 가상 머신 (VM)

컴퓨터 안에 있는 가상의 컴퓨터이다.  

하이퍼바이저를 이용하여 하드웨어를 가상화하는 방법이다.  

가상으로 만들기 위해서는 각 부품들의 기능을 소프트웨어적으로 구현해야 한다.  
<br>

### 호스트 머신

하나 이상의 가상 머신을 구동하는 컴퓨터를 부르는 호칭이다.  
<br>

### 게스트 머신

가상 머신들을 부르는 호칭이다.  
<br>

### 위치와 역할에 따른 분류

- **타입 1 (native 또는 bare-metal)**  

	호스트 하드웨어 위에 설치하여 구동된다.  

	여러 하드웨어 드라이버들을 모두 설정해야 함으로 설치가 까다롭다.  

	자체적으로 머신에 대한 관리 기능이 없기 때문에 관리를 위한 컴퓨터나 콘솔이 필요하다.  

	CPU에 접근하는 방식에 따라 전가상화와 반가상화로 나누어진다.  
<br>

- **타입 2 (hosted)**

	호스트 OS 위에 설치되는 설치하여 구동된다.  

	기존의 컴퓨터 환경을 그대로 사용하여 설치와 구성이 편하다.  

	OS 위에 OS 가 얹히기 때문에 오버헤드가 클 수도 있다.  
<br>

<img src = "../images/posts/201217/hv.png" width = "60%">  
<br>

### 전가상화 (Full-Virtualization or Hardware Virtual Machine)

- 하드웨어를 완전히 가상화 하는 방식이다.

- 하이퍼바이저를 구동하면 DOM 0 라고 하는 관리용 가상 머신이 실행되며,  
모든 가상 머신들의 하드웨어 접근이 DOM 0을 통해 이루어진다.

- 하드웨어를 완전히 가상화하기 때문에 게스트 운영 체제의 별다른 수정이 필요 없다.  
범용성이 가장 뛰어나다.

- 하이퍼바이저가 모든 명령을 중재하기 때문에 속도가 가장 떨어진다.  
<br>

### 반가상화 (Para-Virtualization)

- 하드웨어를 완전히 가상화 하지 않는다.

- 전가상화의 단점인 성능 저하를 해결하기 위해 하이퍼 콜이라는 인터페이스를 통해 하이퍼바이저에게 직접 요청을 할 수 있다.  
	→ 각각의 가상화된 운영 체제들이 각각 다른 번역기를 갖고 있는 것이다.

- 속도가 가장 빠르다.

- 범용성이 가장 떨어진다.  
	
	하이퍼바이저에게 하이퍼 콜을 요청할 수 있도록 각 운영체제의 커널을 수정해야 한다.
	
	또한 오픈소스 OS가 아니면 반가상화를 이용하기 쉽지 않다.  
<br>

## 컨테이너

- 최근 가상화 기술의 트렌드는 하이퍼바이저 기반에서 컨테이너 기반으로 이동하는 추세

- **LXC(Linux Container)** 에서 출발한 기술이다.   

- 호스트 OS 위에 컨테이너 관리 소프트웨어를 설치하여, 논리적으로 컨테이너를 나누어 사용한다.

- 격리된 고유 영역에서 애플리케이션을 실행하는 것을 의미하는 컨테이너는 애플리케이션 실행에 필요한 라이브러리와 바이너리, 기타 구성 파일을 '이미지' 단위로 빌드하여 패키지로 배포한다.

- 실행에 필요한 모든 환경이 준비되어 있으므로 어떤 환경에서도 애플리케이션을 오류 없이 동작시킬 수 있다.

- 컨테이너는 하이퍼바이저와 게스트 운영체제가 필요하지 않으므로 매우 가볍다.  
<br>

## LXC

- 리눅스 컨테이너는 최초의 컨테이너이다.

- 운영 체제 수준의 가상화 기술로, 리눅스 커널을 공유하면서 프로세스를 격리된 환경에서 실행하는 기술이다.

- 커널을 공유하는 방식이기 때문에 속도가 빠르고, 성능 상의 손실이 거의 없다.

- 네임 스페이스와 cgroup을 조합한 형태이다.  
<br>

## 네임스페이스

- IBM 에서 개발  

- 리눅스 커널에 내장되어 있다.  

- 호스트 파일 시스템에 구애받지 않고 독립적으로 파일 시스템을 마운트하거나 언마운트 가능  

- 독립적인 프로세스 공간을 할당  

- namespace 간에 네트워크 충돌 방지 (중복 포트 바인딩 등)  

- 프로세스 간의 독립적인 통신 통로 할당  

- 독립적인 호스트네임 할당  

- 독립적인 사용자 할당  
<br>

## cgroup (Control Groups)

- Google 에서 개발  

- 자원에 대한 제어를 가능하게 해주는 리눅스 커널의 기능이다.  

- 메모리, CPU, I/O, 네트워크, device 노드 등의 리소스를 제어할 수 있다. 
